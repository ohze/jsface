!function(e){var r=e.jsface||require("./jsface"),_=(r.Class,r.classOrNil),c=r.functionOrNil,o=r.extend,d=r.mapOrNil,v="___wrapper___",s="___before_fns___",a="___after_fns___",h="___origin_fn___",i="___advisors___",m=function(){};function y(e,r,t,n){function p(){for(var e,r,t=p[s],n=t.length,o=p[a],i=o.length,f=p[h];n--;)if(r=t[n].apply(this,arguments),d(r)&&!0===r.$skip)return r.$data;for(e=f.apply(this,arguments);i--;)if(r=o[i].apply(this,arguments),d(r)&&!0===r.$skip)return e;return e}return e[v]===e?(e[s].push(r),e[a].push(t),e[i].push(n),e):(o(p,e,0,!0),_(e)&&(p.prototype=e.prototype),p[s]=[r],p[a]=[t],p[h]=e,p[i]=[n],(p[v]=p).$super=e.$super,p.$superp=e.$superp,p)}function w(e,r){var t,n,o;if(e&&e===e[v])if(r){for(n=o=e[i].length;n--&&e[i][n]!==r;);if(0<=n){if(1===o)return w(e);e[i].splice(n,1),e[s].splice(n,1),e[a].splice(n,1)}}else t=e[h],delete e[h],delete e[i],delete e[s],delete e[a],delete e[v];return t}r.pointcut=function(e,r){var t,n,o,i=_(e)||c(e),f=d(e),p=null!==/^remove ?/.exec(r),s=p&&arguments[2];if(!i&&!f||!d(r)&&!p)throw"Invalid params";if(t=i?e.prototype:e,p)return function(o,e,r,i,t,f){var p,n;function s(e,r){var t,n;for(t in e)n=t/1==t?e[t]:t,i&&o[n],"constructor"===n&&i?p=w(i,r):(o[n]&&(o[n]=w(o[n],r)),f[n]&&(f[n]=w(f[n],r)))}if("remove"===e)if(r)s(r,r);else{for(var a in p=i&&o===o[v]&&o[h],f)f[a]=w(f[a])||f[a];for(var a in o)o[a]=w(o[a])||o[a]}else{if(null===(n=/^remove /.exec(e)))throw"Invalid params";s(e.replace(n,"").split(" "))}return p||o}(e,r,s,i,0,t);for(n in r){o=r[n],o=c(o)?{before:o}:o;var a=d(o)&&!o.before?m:o.before,l=d(o)&&!o.after?m:o.after,u=!1;if(!c(a))throw"Invalid "+n+":before";if(!c(l))throw"Invalid "+n+":after";if(f){if(!c(t[n]))throw"Non-function property named "+n+" on instance";t[n]=y(t[n],a,l,r)}else if("constructor"===n)e=y(e,a,l,r);else if(c(e[n])&&(e[n]=y(e[n],a,l,r),u=!0),c(t[n])&&(t[n]=y(t[n],a,l,r),u=!0),!u)throw"Non-function property named "+n+" on class"}return e},"undefined"!=typeof module&&module.exports&&(module.exports=r.pointcut)}(this);